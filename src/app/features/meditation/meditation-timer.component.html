<div class="meditation-container" [class.fullscreen]="isFullscreen()">
  <!-- Header -->
  <div class="meditation-header" *ngIf="!isFullscreen()">
    <h1 class="meditation-title">Meditation Timer</h1>
    <div class="header-controls">
      <button
        mat-icon-button
        [matTooltip]="isFullscreen() ? 'Exit Fullscreen (F)' : 'Enter Fullscreen (F)'"
        (click)="toggleFullscreen()"
        class="fullscreen-btn">
        <mat-icon>{{ isFullscreen() ? 'fullscreen_exit' : 'fullscreen' }}</mat-icon>
      </button>
    </div>
  </div>

  <!-- Main Timer Section -->
  <div class="meditation-main">
    <div class="timer-display-section">
      <div class="breathing-animation" [class.breathing-in]="currentPhase() === 'in'" [class.breathing-out]="currentPhase() === 'out'">
        <div class="circle">
          <div class="inner-circle"></div>
        </div>
      </div>

      <div class="phase-indicator">
        <h2>{{ phaseLabel() }}</h2>
        <div class="time-remaining">{{ formatTime(timeRemaining()) }}</div>
      </div>

      <div class="progress-container">
        <mat-progress-bar mode="determinate" [value]="progress()"></mat-progress-bar>
        <div class="cycle-counter">Cycle: {{ currentCycle() }} of {{ totalCycles() }}</div>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls-section">
      <div class="action-group">
        <button mat-fab color="primary" (click)="isRunning() ? pauseTimer() : startTimer()" class="primary-button">
          <mat-icon>{{ isRunning() ? 'pause' : 'play_arrow' }}</mat-icon>
        </button>
      </div>
      <div class="secondary-buttons">
        <button mat-raised-button color="warn" (click)="resetTimer()" [disabled]="!isRunning() && !isCompleted()" class="control-btn">
          <mat-icon>restart_alt</mat-icon>
          <span class="btn-text">Reset</span>
        </button>
        <button
          *ngIf="isFullscreen()"
          mat-stroked-button
          (click)="toggleFullscreen()"
          class="control-btn">
          <mat-icon>fullscreen_exit</mat-icon>
          <span class="btn-text">Exit</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Settings Section (hidden in fullscreen) -->
  <div class="settings-section" *ngIf="!isFullscreen()">
    <h3>Settings</h3>
    <div class="settings-grid">
      <div class="setting">
        <mat-form-field appearance="fill">
          <mat-label>Breathe In (seconds)</mat-label>
          <input matInput type="number" [ngModel]="breatheInDuration()" (ngModelChange)="breatheInDuration.set($event)" min="1" max="60">
        </mat-form-field>
      </div>

      <div class="setting">
        <mat-form-field appearance="fill">
          <mat-label>Breathe Out (seconds)</mat-label>
          <input matInput type="number" [ngModel]="breatheOutDuration()" (ngModelChange)="breatheOutDuration.set($event)" min="1" max="60">
        </mat-form-field>
      </div>

      <div class="setting">
        <mat-form-field appearance="fill">
          <mat-label>Total Cycles</mat-label>
          <input matInput type="number" [ngModel]="totalCycles()" (ngModelChange)="totalCycles.set($event)" min="1" max="100">
        </mat-form-field>
      </div>

      <div class="setting">
        <mat-slide-toggle [ngModel]="enableSound()" (ngModelChange)="enableSound.set($event)">Enable Sound</mat-slide-toggle>
      </div>
    </div>
  </div>
  
  <!-- Ad Slots (hidden in fullscreen) -->
  <div class="meditation-ads" *ngIf="!isFullscreen()">
    <app-ad-slot size="leaderboard" position="top" [showPlaceholder]="true"></app-ad-slot>
    <app-ad-slot size="leaderboard" position="bottom" [showPlaceholder]="true"></app-ad-slot>
  </div>
</div>